---
title: Name Resolution
date: 2019-08-24 22:20:28
categories: Sams-Teach-yourself-TCP/IP-in-24-hours
tags: [notes, TCP/IP, Networks]
---

本文目的：

- 解释如何进行域名解析
- 解释主机名（hostname），域名和FQDNs的区别
- 描述主机名解析
- 描述DNS名字解析
- 描述在某些遗留微软网络上使用的NetBIOS名字解析

## What is Name Resolution

主机名系统是在TCP/IP历史上早期开发的简单的名字解析技术。系统中，每台计算机被分配给一个称为**主机名**的含有字母数字的名字。如果操作系统希望是一个IP地址的时候却碰上一个字母数字名字，则操作系统会查询一个**hosts文件**。hosts文件是一个包含主机名和IP地址关联的列表。如果字母数字名字在主机名列表上，计算机读取和名字相关联的IP地址。然后计算机使用相关的IP地址替换命令中主机名并且执行命令。

![93625dcb59ed467d.svg](https://i.quantuminit.com/93625dcb59ed467d.svg)

- 在每组特殊的域名服务器之间分发名字解析的责任。名字解析服务器维护定义了名字到地址关联的表。
- 授权本地名字解析权利给本地管理员。换句话说，就是不维护一份所有名字到地址关联表的中心化，主要版本，让网络A上个一个管理员负责网络A上的名字解析，以及让网络B上的管理员管理网络B上的名字解析。通过那样子的方式，每个单独的网络上的管理员负责网络上的任何更新也要负责确保那些更新反应到名字解析的基础设施。

以上两点优先级主导了域名系统（DNS）的开发。DNS将名字空间分割成称为域名的层次实体。域名可以和主机包含在一起，称之为主机域名全称（FQDN）。例如，主机名是www，且在域名quantuminit.com中，则构成的FQDN是www.quantuminit.com。

## Name Resolution Using Hosts Files

操作系统支持TCP/IP识别hosts文件并且在需要很少或者没有来自用户的干预下用它来进行名字解析。根据实现方式，配置主机名的细节也不相同。步骤大致如下：

1. 给每台计算机分配一个IP地址以及主机名
2. 创建一个映射IP地址到每台计算机的主机名的host文件。host文件经常命名为hosts，尽管有些实现使用的文件名为hosts.txt。
3. 将hosts文件放置到每台计算机设计好的目录中。根据不同的操作系统，目录的位置也不相同。

hosts文件包含有一台计算机需要想要与之通信的主机条目，允许输入和主机名，FQDN或是其他静态地别名相关的IP地址。当然里面还有一个条目用于[loopback 地址](/The-Internet-Layer/#Special-IP-Address)，即127.0.0.1。这个loopbakc地址用于给TCP/IP诊断并且代表当前这台计算机。

一个hosts文件示例：

![c18b44dc38ee4716.svg](https://i.quantuminit.com/c18b44dc38ee4716.svg)

当一台计算机上的一个应用需要解析一个名字成一个IP地址的时候，系统首先比较它自己的名字和被请求的名字。如果不匹配，系统将会进入hosts文件中查找（如果存在）是否有该计算机名在里面。如果能够匹配到一个，返回这个IP地址到本地计算机。通过使用IP以及ARP传输技术两台计算机之间产生通信。

创建或编辑hosts文件时的一些要点：

- IP地址必须左对齐并且使用一个或多个空格将它与主机名分隔开
- 名字必须被至少一个空格分隔开
- 在单行上多余的名字将会是第一个名字的别名。
- 文件从上到下被解析（计算机读取）。使用第一个和IP地址关联的匹配。当匹配成功时，则停止解析。
- 因为是从上到下进行解析，所以应该将常用的名字放置在上方。这样子可以加速解析过程。
- 使用*#*开头后面跟文本来表示注释
- 记住hosts文件是静态的；当IP地址发生更改时，必须手动更改hosts文件。
- 尽管FQDNs被允许以及在存在hosts文件中，但是不鼓励在hosts文件这么使用它们并且导致管理员在诊断时造成问题。控制hosts文件的管理员不能控制远程网络上的地址的分配以及主机名。

## DNS Name Resolution

DNS 存储名字解析在一台或多台特殊的服务器中。DNS服务器为网络提供名字解析服务。

![818cd5af384348c7.svg](https://i.quantuminit.com/818cd5af384348c7.svg)

上图中的DNS服务器的优点之一，为本地网络以及提供单一的DNS配置点以及高校的利用网络资源。然而并未为更大型网络基础设施的提供去中心化管理，以及不能够有效地运行一个含有网络上每个主机的IP地址记录的数据库。即使可以，但是在单台DNS服务器上维护所有互联网上的数据库是禁止的。

更好的方式是然每个办公室或学术机构配置运行一台本地的名字服务器，然后为所有的名字服务器提供能够与彼此之间进行通信的方式。当某个DNS客户端发送名字解析请求到名字解析服务器的时候，名字服务器按如下的方式之一进行工作：

- 如果名字服务器能够在自己的地址数据库中找到请求的地址，则立即发送这个地址给客户端。
- 如果服务器不能在自己的数据库记录中找到地址，则向其他名字服务器查找该地址然后发送该地址给客户端。

![35d10c4a3a6b449c.svg](https://i.quantuminit.com/35d10c4a3a6b449c.svg)

DNS不是严格地与主机名协作，而是与FADNs协作。在DNS树的顶部是一个称为根的单个结点。根有时候又称为句点（.)，尽管根的实际符号是null字符。根的下面是一组称为顶级域名（TLDs）的的域名。

![https://i.quantuminit.com/79848b7aecf24386.svg](https://i.quantuminit.com/79848b7aecf24386.svg)

总的来说，DNS系统支持高达127层域名分级。

![https://i.quantuminit.com/8e38575d227848b7.svg](https://i.quantuminit.com/8e38575d227848b7.svg)

当网络上的一台主机需要一个IP地址的时候，它通常发送一个递归查询到邻近的名字服务器。这个查询告诉名字服务器，要么给出和这个名字相关联的IP地址，否则返回响应表示不能找到。名字查询过程中使用递归查询（主机发送）以及迭代查询（名字服务器发送）。总结出查询的过程就是，客户端发送一个单独的递归查询该名字服务器，然后名字服务器发送一系列的迭代查询到其他名字服务器来解析这个名字。当名字服务器获取到与这个名字相关联的地址时，则使用这个地址响应客户端的查询。

DNS名字解析过程：

1. 主机1发送一个递归查询给名字服务器A询问和域名c.b.a.edu相关联的IP地址。
2. 名字服务器A检查自己的记录是否有这个请求的地址。如果名字服务器A有这个地址，则返回该地址给主机1。
3. 如果名字服务器A没有这个地址。由A初始查找地址的过程。名字服务器A为了获取该地址发送一个迭代请求到名字服务器B，.edu域名的顶级名字服务器询问和c.b.a.edu相关联的地址。
4. 名字服务器B不能提供地址，但是能够发送名字服务器C的地址给名字服务器A，即a.edu的名字服务器。
5. 名字服务器A发送查询该地址的请求给名字服务器C。名字服务器C不能够提供这个地址，但是能够发送名字服务器D的地址，就b.a.edu的名字服务器。
6. 名字服务器A发送获取该IP地址的请求到名字服务器D。名字服务器D查询主机c.b.a.edu的地址并且发送这个地址给名字服务器A。然后名字服务器A发送这个地址给主机1。
7. 主机1初始化一个连接到主机c.b.a.edu的连接。

![https://i.quantuminit.com/7fd227e581c7494f.svg](https://i.quantuminit.com/7fd227e581c7494f.svg)

## Registering a Domain

ICANN有完整域名注册任务的授权但是委托特定的顶级域名的注册到其他组织。VeriSign当前负责维护DNS根区域。其他组织维护顶级域名的系统。例如：

- **.com, org 以及 .net**：许多称为登记处的公司被授权为受欢迎的.com，.org和.net顶级域名提供名字解析服务，还有很少被人们所知的域，例如.info，.museum，.name以及.pro。VeriSign负责授权登记.com和.net域，以及公共互联网注册(PIR) 维护.org。
- **.gov**：给US联邦政府所保留的域。
- National domains：可能你已经注意到许多国家都有它们自己的域名空间。比如.uk，.fr，.de，.ca，.us等国家代码顶级域名（ccTLDs）。

## Name Server Types

在网络上实现DNS，至少需要一个主服务器负责维护域名。从本地文件中获取负责区域的所有信息的主名字服务器，从主名字服务器的**区域文件**获取信息并响应服务请求的备份名字服务器（又称第二名字服务器），响应来自本地网络上的客户端的域名解析请求查询的只缓存服务器。只缓存服务器向其他DNS服务器查询域名信息以及提供比如Web和FTP服务的计算机。当收到来自其他DNS服务器的信息是，将那些信息存储在缓存中以防万一再次请求这些信息。只缓存服务器被本地网络上的客户端计算用来解析名字。互联网上的其他DNS服务器不会知道这些只缓存服务器并且因此不会查询它们。

### Domains and Zones

在含有一组通用的DNS服务器的集合配置中的一组DNS主机称为**区域（zone）**。简单网络上，一个区域可能代表了一个完整的DNS域。更复杂的网络上，子域的DNS配置有时候委托到服务这个子域的另一个区域。区域委托让管理员具备更快速地知道管理一个子网络管理那个子网络的DNS配置。
区域（zone）以及域（domain）的区别不仅体现在精细的语义上（域是命名空间的细分并且区域是一个主机集合），区域和域的概念不是平行的。在读这部分内容事，要记住：

- 在子域中的成员资格暗示了在父域中的成员资格。例如，在b.a.edu中的一台主机是a.edu的一部分。相反，如果b.a.edu的域是被委托的，则在b.a.edu的主机不是a.edu区域中的一部分。
- 如果子域不是被特别地委托，则不需要一个单独的区域并且简单地与父域的区域文件包含在一起。

一个区域代表一组DNS服务器以及主机的集合配置，并且DNS管理员为了提高管理效率可选择性地委托部分名字空间到其他区域。

### Zone Files

一个DNS区域是一个表示存在DNS命名空间中的一个计算机集合的管理单元。一个区域的DNS配置被存在一个区域文件中。当响应查询以及初始请求的时候，DNS服务器查询在区域文件中的信息。一个区域文件是一个具有标准化结构的文本文档。区域文件由多个**资源记录**构成。一些资源记录的常见类型：

- SOA：SOA表示Start of Authority。SOA记录指明了这个区域的权威的名字服务器。
- NS：NS表示Name Server。NS记录指明了这个区域的一个名字服务器。一个区域可能含有几个名字服务器（因此，有多个NS记录）但是只能有一个SOA记录用于权威的名字服务器。
- A：一条A记录将一个DNS名字映射到一个IPv4地址。
- AAAA：一条AAAA记录将一个DNS名字映射到一个IPv6地址。
- PTR：一条PTR记录将一个IP地址映射到一个DNS名字。
- CNAME：CNAME是canonical name的缩写。一条CNAME记录映射一个别名到由A一条A记录表示的实际的主机名。

因此，这个区域文件告诉DNS服务器一下信息：

- 这个区域的权威的名字服务器。
- 在这个区域的DNS服务器（权威的以及非权威的）。
- 在区域内的主机的别名（备用名字）之内的DNS-name-to-IP-address映射。


