---
title: Routing
date: 2019-08-15 12:37:59
categories: Sams-Teach-yourself-TCP/IP-in-24-hours
tags: [notes, TCP/IP, Networks]
---

本文目的：

- 描述IP转发以及它是如何工作的
- 分辨距离向量路由和链路状态路由
- 讨论核心，内部和外部路由的角色
- 描述公共内部路由RIP以及OSPF协议

## Routing in TCP/IP

在最基本的性质中，一个路由器（router）是通过逻辑地址（logical address）转发流量的一个设备。一个经典的路由器使用
Internet layer头部的IP地址信息工作在Internet layer（对应于OSI模型中的网络层（Network layer））。
因为OSI中网络层也称为第三层，因此有时候又称一个路由器为第三层设备。还有更高层的路由器（位于OSI模型中的4-7层）。

路由器是任何大型TCP/IP网络必需的部分。当路由器从一个网络传递数据到下一个网络时，路由器替换网络层（Network 
Access layer）头部信息，所以路由器能够连接不相似的网络类型。许多路由器维护着基于距离，带宽以及时间考虑的最佳路径
的详细信息。

## What Is a Router

在最简单的形式（或至少在最基本形式中），一个路由器看起来就像是一台有两个网络适配器的计算机。早期的路由器确实是有两
个或更多网络适配器的计算机（称之为多重连接计算机）。理解路由的第一步是要记住IP地址是属于适配器而不是计算机。事实
上，两个适配器是有可能处在对应于完全不同物理网络的完全不同的IP子网上。

![e7dc4d3cf4c249b8.svg](https://i.quantuminit.com/e7dc4d3cf4c249b8.svg)

复杂网络上的路由：

![7be3ab7d8e30478d.svg](https://i.quantuminit.com/7be3ab7d8e30478d.svg)

## The Routing process

路由器职责的一个更普遍的描述：

1. 路由器从它连接的网络之一接收数据。
2. 路由器往协议栈向上传递数据到Internet layer。换句话说，路由器丢弃Network Access 层的头部信息并且重组（如果
有必要）数据报。
3. 路由器检查IP头部中的目的地址。
4. 如果数据注定要发往不同的网络，路由器查询路由表来决定往哪个地方发送数据。
5. 在路由器决定它的哪个适配器将接收数据之后，它将会向下传递数据通过适合的Network Access层软件通过适配器具进行传输。

事实上，路由表以及建立路由表的协议是路由器的明显特征。

路由过程图示：

![a188425ba8714eed.svg](https://i.quantuminit.com/a188425ba8714eed.svg)

根据获取路由表信息来源，两种主要类型路由的命名：

- 静态路由：需要网络管理员后动输入路由信息
- 动态路由：使用路由协议基于获取的路由信息动态建立路由表。

静态路由局限性:

1. 不能很好地适配具有成百上千个路由的大型网络
2. 除了最简单的网络之外的所有网络，静态路由需要网络管理员不成比例的时间投入，网络管理员不仅仅是创建而且不断的更新
路由表信息。
3. 静态路由不能很快的适应网络，例如，一个宕机的路由器。

### 预配置路由

预配置静态路由有时候用于网络问题排障。在其他情况下，管理员可能提供静态路径来充分利用快速的网络连接或平衡网络流量。

## Routing Table Concepts

路由表的职责以及其他Internet layer的路由元素是为了传输数据到适当的本地网络。

一张极其基本的路由表内容：

![dba2c75bdb7e4654.svg](https://i.quantuminit.com/dba2c75bdb7e4654.svg)

路由表本质上是将目的网络IDs映射到下一跳的IP地址——数据报在去往目的网络的下一站。路由表在网络直接连接路由器本身和网
络通过其他路由器间接链接是有区别的。下一跳可能是目的网络（如果是直接连接）或前往目的网络的下一个下游路由器。
The Router Port与通过哪个路由器转发数据的路由器端口相关。路由表中的下一跳条目是理解动态路由的关键。复杂网路中，
可能存在多条到达目的网络的路径，路由器必须决定下一跳跟着这些路径中的一条。动态路由基于通过路由协议获取的信息做出决
策。

## A Look at IP Forwarding

主机和路由器都有路由表，主机的路由表比路由器的路由表更见，主机经常利用默认路由器或默认网关。默认网关是接收不能在本
地网络上进行传输的数据报的路由器。对于一台计算机，路由表可能只含有两行：一行本地网络的条目和用于不能在本地网络段进
行传输的数据包的默认路由。

**IP forwarding**过程实际上不是将路由器的地址放到IP header中。而是，主机向下传递数据报和路由器的IP地址到
Network Access层，Network Access层的协议软件使用一个分开的单独查询过程将数据报包装在一个帧中用于本地传输到路
由器。换句话说，一个转发的数据报的IP地址跟最终收到的数据的主机有关。中继数据报到本地网络上的路由器的帧的物理地址是
路由器适配器的物理地址。

简要描述该过程：

1. 一台主机网要发送数据报。主机检查它的路由表。
2. 如果数据报不能在本地网络上被传输，主机从路由表中提取与目标地址相关相关联的路由器的IP地址。（万一主机在本地网络段中，这个路由器的IP地址很大可能是默认网关的地址。）然后使用ARP将路由器的IP地址解析为物理地址。
3. 发往远程主机的数据报与收到数据报的路由器的物理地址被传递给网络接入层（Network Access layer）。
4. 路由器的网络适配器收到帧，因为帧的目的物理地址与路由器的物理地址匹配。
5. 路由器拆开数据帧并且往上传到Internet layer。
6. 路由器检查数据包的IP地址。如果IP地址匹配路由器自己的IP地址，则数据的目的地址就是路由器本身，否则，路由器通过检查自己的路由表来找到与数据帧目的地址相关联的路由，然后尝试转发数据帧。
7. 如果数据报不能被任何和路由器相连的网络段传输，路由器发送数据报到另外一个路由器，然后重复（回到步骤 1），直到最
后的路由器能够直接将数据报传输给目的主机。

![e092c3a432134421.svg](https://i.quantuminit.com/e092c3a432134421.svg)

上述描述的步骤6是一个路由器的一个重要特征。一个设备想要像一个路由器一样工作，除了有两个网卡，还得这个设备有支持IP
转发的必需软件，否则数据不会从一个接口传递到另外一个接口。当一台计算机未被配置为IP路由时，它收到的数据报是发往不同的计算机，数据报被简单地忽略掉。

## Direct Versus Indirect Routing

如果一个路由器仅仅是连接两个子网，那这个路由器的路由表可能会很简单。该路由器将不会碰上IP地址不会和它的端口相关联的情况，并且路由器是直接连接在所有的子网上。

![037834ce7d2943e8.svg](https://i.quantuminit.com/037834ce7d2943e8.svg)

稍微更复杂的网络：

![ac4b3279001f4b27.svg](https://i.quantuminit.com/ac4b3279001f4b27.svg)

有两种方式知道间接路由：从系统管理员或其他路由器。这两个选项各自与静态路由和动态路由相关。系统管理员直接输入网络路由到路由表中，这是静态路由，或Router B告诉Router A相关的网段，这是动态路由。

动态路由优点：

- 不要人工干预
- 响应网络中的变化，假设一个新的网段连接到Router B，Router B通知Router A这个网络变化。
